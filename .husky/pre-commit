#!/bin/sh

# Check if we're in a project with package.json for Node.js projects
if [ -f "package.json" ]; then
  echo "🔍 Running frontend tests and lint..."
  if [ -f "yarn.lock" ]; then
    yarn lint 2>/dev/null || echo "Lint not configured"
    yarn test 2>/dev/null || echo "Test not configured"
  elif [ -f "pnpm-lock.yaml" ]; then
    pnpm lint 2>/dev/null || echo "Lint not configured"
    pnpm test 2>/dev/null || echo "Test not configured"
  else
    npm run lint 2>/dev/null || echo "Lint not configured"
    npm test 2>/dev/null || echo "Test not configured"
  fi
fi

# Check for Python projects
if [ -f "requirements.txt" ] || [ -f "pyproject.toml" ] || [ -f "setup.py" ]; then
  echo "🔍 Running Python checks..."
  if command -v ruff >/dev/null 2>&1; then
    ruff check . 2>/dev/null || echo "Ruff not configured"
  fi
  if command -v black >/dev/null 2>&1; then
    black --check . 2>/dev/null || echo "Black not configured"
  fi
  if command -v pytest >/dev/null 2>&1; then
    pytest 2>/dev/null || echo "Pytest not configured"
  fi
fi

# For this specific project (UDP streaming system)
if [ -f "docker-compose.yml" ]; then
  echo "🔍 Validating Docker Compose configuration..."
  docker-compose config >/dev/null 2>&1 || echo "Docker Compose validation failed"
fi

echo "✅ Pre-commit checks completed"
